<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>进行中</title>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../css/order.css"/>
    <script src="../script/template-web.js"></script>
    <style>
    .from-to{
      -webkit-box-flex: 4;
      -webkit-flex: 4;
      flex: 4;
      margin: 20px 0px;
    }
    .from-to .middle{
      position: relative;
      height: 91px;
      width: 100%;
      background-image: url("../image/travel.png");
      background-repeat: no-repeat;
      background-size: 40px 40px;
      background-position: center;
    }
    .from-to .addr{
      font-size:20px;
      color:grey;
    }
    .from-to .time{
      font-size:45px;
    }
    .from-to .date{
      font-size:14px;
      color:grey;
    }
    .driver .drivername{
      text-align: left;
    }
    .driver .drivertel{
      text-align: right;
    }
    </style>
</head>
<body>
   <div id="content"></div>
   <script id="order-template" type="text/html">
     {{if noneorder}}
     <div class="noneorder">
       <div class="icon-no"></div>
       <div class="text">暂无相关订单</div>
     </div>
     {{else if !noneorder}}
     <div class="order wrap-col">
       <div class="carinfo wrap-row item">
         <div class="logo"></div>
         <span class="carname">{{carinfo}}</span>
       </div>
       <div class="from-to wrap-row item">
         <div class="from item">
           <div class="addr fromaddr">{{source}}</div>
           <div class="time fromtime">{{fromtime}}</div>
           <div class="date fromdate">{{date}}</div>
         </div>
         <div class="middle item"></div>
         <div class="to item">
           <div class="addr toaddr">{{destination}}</div>
           <div class="time totime">{{totime}}</div>
           <div class="date todate">{{date}}</div>
         </div>
       </div>
       <div class="driver wrap-row item">
         <div class="drivername item">司机:{{drivername}}</div>
         <div class="drivertel item">联系电话:{{drivertel}}</div>
       </div>
     </div>
     {{/if}}
   </script>
   <script type="text/javascript" src="../script/api.js"></script>
   <script type="text/javascript" src="../script/common.js"></script>
   <script type="text/javascript" src="../script/SHA1.js"></script>
   <script type="text/javascript" src="../script/APICloud-rest.js"></script>
   <script>
   apiready=function(){
     fnGetOrder();
     fnPullRefresh();
   };

   var userInfo=$api.getStorage("userInfo");
   var data={noneorder:true};

   function fnGetOrder(){

     api.ajax({
         url: 'http://'+url+':'+port+':8080/orders/processin'+"?userId="+userInfo.userId,
         method: 'get',
         headers: {
               'Content-Type': 'application/json;charset=utf-8'
           }
     }, function(ret, err) {
       if(ret.data){
         var order=ret.data;
         var timearray=order["time"].split(" -- ",2);
         data = {
            noneorder:false,
            fromtime:timearray[0],
            totime:timearray[1],
            carinfo:order["carNum"],
            source:order["source"],
            destination:order["destination"],
            drivername:order["driverName"],
            drivertel:order["dnum"],
            date:order["date"]
          };
       }
       var html = template('order-template', data); //data为模板数据
       document.getElementById('content').innerHTML = html; //将生成的模板填充添加到对应的容器中
        });
   }
   function fnPullRefresh(){
       api.setCustomRefreshHeaderInfo({
           bgColor : '#f0f0f0',
       }, function() {
           fnGetOrder();
           setTimeout(
             function(){
               api.refreshHeaderLoadDone();
             },500);
       });
   }



    //var data = {
    //noneorder:true,
    //  time:"21:00 -- 23:00",
    //  detailaddr:"中南海405"
    //  carinfo:"宝马 沪A66666",
    //  status: "1",
    //  source:"上海",
    //  destination:"杭州",
    //  peoplecount:"2".
    //  drivername:"老司机",
    //  custel:   "10086111008",
    //  drivertel:"18977778888",
    //  date:"2019-1-23"
    //};
    // var html = template('order-template', data); //data为模板数据
    //document.getElementById('content').innerHTML = html; //将生成的模板填充添加到对应的容器中
   </script>
</body>
</html>
